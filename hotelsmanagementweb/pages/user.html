<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <title>HaNoiBooking.</title>
    <link rel="stylesheet" type="text/css" href="../css/user.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        .booking-list-outer {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 0;
            margin: 0;
            background: transparent;
            height: auto;
            position: relative;
        }

        .booking-list {
            display: flex;
            flex-wrap: wrap;
            flex-direction: row;
            gap: 24px;
            width: 100%;
            min-height: 100%;
            height: auto;
            align-items: flex-start;
            padding: 0 0 24px 0;
            margin: 0;
            justify-content: flex-start;
        }

        .booking-list::-webkit-scrollbar {
            height: 12px;
            background: #f1f1f1;
        }

        .booking-list-outer::-webkit-scrollbar {
            height: 12px;
            background: #f1f1f1;
        }

        .booking-list-outer::-webkit-scrollbar-thumb {
            background: #bbb;
            border-radius: 8px;
        }

        .card {
            flex: 1 1 320px;
            min-width: 280px;
            max-width: 420px;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            margin-bottom: 0;
            transition: box-shadow 0.2s, transform 0.2s;
            height: 600px;
        }

        .card:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            transform: translateY(-4px);
        }

        .card__img {
            position: relative;
            height: 55%;
            min-height: 180px;
            width: 100%;
            overflow: hidden;
        }

        .card__img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .status-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #FFC107;
            color: white;
            font-weight: 600;
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 20px;
            z-index: 2;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .card__info {
            flex: 1 1 45%;
            min-height: 180px;
            max-height: 260px;
            overflow-y: auto;
            padding: 18px 18px 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            font-size: 16px;
            color: #222;
            background: #fff;
            border-top: 1px solid #f0f0f0;
            border-radius: 0 0 16px 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
            text-align: center;
        }

        .card__info .date {
            font-weight: 700;
            border-bottom: 1px solid #eee;
            margin-bottom: 10px;
            padding-bottom: 4px;
            font-size: 18px;
            color: #1a237e;
            width: 100%;
            text-align: center;
        }

        .card__info .day {
            font-size: 15px;
            color: #444;
            margin-bottom: 4px;
            width: 100%;
            text-align: center;
        }

        .card__info .location {
            font-size: 16px;
            color: #222;
            font-weight: 600;
            margin-bottom: 4px;
            width: 100%;
            text-align: center;
        }

        .card__info .room-type {
            font-size: 17px;
            color: #1976d2;
            font-weight: 700;
            margin-bottom: 8px;
            margin-top: 2px;
            width: 100%;
            text-align: center;
            letter-spacing: 0.5px;
        }

        .card__info .address {
            font-size: 15px;
            color: #666;
            margin-bottom: 4px;
            width: 100%;
            text-align: center;
        }

        .card__info .total-price {
            color: #ff5722;
            font-weight: bold;
            margin-top: 16px;
            font-size: 22px;
            width: 100%;
            text-align: center;
            letter-spacing: 0.5px;
        }

        .card__info .status-badge {
            display: inline-block;
            margin-bottom: 10px;
            padding: 5px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            background: #bdbdbd;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
        }

        .card__info .status-success {
            background: #43a047;
        }

        .card__info .status-pending {
            background: #ffc107;
            color: #222;
        }

        .card__info .status-failed {
            background: #e53935;
        }

        @media (max-width: 1200px) {
            .booking-list {
                gap: 16px;
            }

            .card {
                max-width: 340px;
                height: 520px;
            }
        }

        @media (max-width: 900px) {
            .booking-list {
                gap: 12px;
            }

            .card {
                max-width: 320px;
                height: 480px;
            }
        }

        @media (max-width: 700px) {
            .booking-list {
                flex-direction: column;
                flex-wrap: nowrap;
                gap: 16px;
                align-items: center;
                justify-content: center;
            }

            .card {
                min-width: 90vw;
                max-width: 98vw;
                width: 100%;
                height: auto;
            }

            .card__img {
                min-height: 140px;
                height: 180px;
            }

            .card__info {
                min-height: 120px;
                max-height: none;
                font-size: 15px;
                padding: 12px 8px 12px;
            }
        }

        @media (max-width: 480px) {
            .booking-list {
                gap: 8px;
            }

            .card {
                min-width: 98vw;
                max-width: 100vw;
                height: auto;
                border-radius: 10px;
            }

            .card__img {
                min-height: 100px;
                height: 120px;
            }

            .card__info {
                font-size: 14px;
                padding: 8px 4px 8px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="menu">
            <div class="logo">
                <span class="logo-light">HaNoi</span><span class="logo-bold">Booking.</span>
            </div>
            <div class="menu__func">
                <div class="func1 active" onclick="switchSection('bookings')">
                    <i class="fa-solid fa-file-invoice"></i>
                    <p class="func-title">Bookings</p>
                </div>
                <div class="func2" onclick="switchSection('transactions')">
                    <i class="fa-solid fa-credit-card"></i>
                    <p class="func-title">Transactions</p>
                </div>
                <div class="func3" onclick="switchSection('account')">
                    <i class="fa-solid fa-id-badge"></i>
                    <p class="func-title">Your Account</p>
                </div>
                <div class="func4">
                    <i class="fa-solid fa-circle-info"></i>
                    <p class="func-title">Help</p>
                </div>
                <div class="func5">
                    <i class="fa-solid fa-message"></i>
                    <p class="func-title">Message</p>
                </div>
            </div>
        </div>

        <div class="main">
            <div class="header">
                <div class="hello__user">
                    <h1 class="hello-user">Hello, <span id="userFullName"></span></h1>
                    <p class="hello-title">Have a nice day</p>
                </div>

                <div class="login">
                    <div class="noti-wrapper" onclick="toggleNoti()">
                        <div class="icon">
                            <i class="fa-solid fa-bell"></i>
                            <span class="dot has-noti"></span>
                        </div>
                        <div class="noti-tab" id="notiTab">
                            <div class="noti-header">
                                <h3>Notifications</h3>
                                <span class="noti-count">1</span>
                            </div>
                            <div class="noti-list">
                                <div class="noti-item unread">
                                    <div class="noti-icon">
                                        <i class="fa-solid fa-circle-check"></i>
                                    </div>
                                    <div class="noti-content">
                                        <p class="noti-text">Your booking has been confirmed!</p>
                                        <span class="noti-time">2 minutes ago</span>
                                    </div>
                                </div>
                                <div class="noti-item">
                                    <div class="noti-icon">
                                        <i class="fa-solid fa-tag"></i>
                                    </div>
                                    <div class="noti-content">
                                        <p class="noti-text">Special offer: Get 20% off on your next booking</p>
                                        <span class="noti-time">2 hours ago</span>
                                    </div>
                                </div>
                            </div>
                            <div class="noti-footer">
                                <a href="#">View all notifications</a>
                            </div>
                        </div>
                    </div>

                    <div class="vector"></div>

                    <div class="user-box" onclick="toggleDropdown()">
                        <div class="avatar"></div>
                        <div class="user-info">
                            <div class="user-name"></div>
                            <div class="user-role"></div>
                        </div>
                        <i class="fa-solid fa-chevron-down"></i>

                        <div class="dropdown" id="userDropdown">
                            <a href="#"><i class="fa-regular fa-calendar-check"></i>My Booking</a>
                            <div class="dropdown-divider"></div>
                            <a href="#" class="logout"><i class="fa-solid fa-right-from-bracket"></i>Log out</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bookings Section -->
            <div id="bookings" class="content-section active">
                <h2 class="list-title">Booking List</h2>
                <div class="booking-list-outer">
                    <div class="booking-list">
                        {% if bookings and bookings|length > 0 %}
                        {% for booking in bookings %}
                        <div class="card">
                            <div class="card__img">
                                <div class="status-badge status-{{ booking.status|lower }}">
                                    {% if booking.status == 'success' %}
                                    Success
                                    {% elif booking.status == 'pending' %}
                                    Pending
                                    {% elif booking.status == 'failed' %}
                                    Failed
                                    {% else %}
                                    {{ booking.status|capitalize }}
                                    {% endif %}
                                </div>
                                <img src="{{ booking.image_url or '/assets/image/default-room.webp' }}"
                                    alt="Room Image">
                            </div>
                            <div class="card__info">
                                <div class="date"><b>{{ booking.check_in }} - {{ booking.check_out }}</b></div>
                                <div class="day">{{ (booking.check_out - booking.check_in).days if booking.check_in and
                                    booking.check_out else '' }} Day(s)</div>
                                <div class="location">{{ booking.hotel_name if booking.hotel_name else '' }}</div>
                                <div class="room-type">{{ booking.room_type if booking.room_type else '' }}</div>
                                <div class="address">{{ booking.hotel_address if booking.hotel_address else '' }}</div>
                                <div class="total-price">Total: {{ booking.total_price|format_price if
                                    booking.total_price
                                    else '0₫' }}</div>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="no-bookings">You have no bookings yet</div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Transactions Section -->
            <div id="transactions" class="content-section">
                <h2 class="list-title">Transaction History</h2>
                <div class="transactions-list">
                    {% if transactions and transactions|length > 0 %}
                    {% for t in transactions %}
                    <div class="transaction-card">
                        <div class="transaction-header">
                            <div class="transaction-date">{{ t.created_at.strftime('%Y-%m-%d') if t.created_at else ''
                                }}</div>
                            <div class="transaction-id">#{{ t.txn_ref or t.payment_id }}</div>
                        </div>
                        <div class="transaction-amount">{{ t.amount }} VND</div>
                        <div class="transaction-info">
                            <div class="transaction-hotel">{{ t.booking.hotel.hotel_name if t.booking and
                                t.booking.hotel else '' }}</div>
                            <div class="transaction-nights">{{ (t.booking.check_out - t.booking.check_in).days if
                                t.booking and t.booking.check_in and t.booking.check_out else 1 }} nights</div>
                        </div>
                        <span class="transaction-status status-{{ t.payment_status|lower }}">
                            {{ t.payment_status|capitalize }}
                        </span>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div class="no-transactions">No transactions found</div>
                    {% endif %}
                </div>
            </div>

            <!-- Account Section -->
            <div id="account" class="content-section">
                <h2 class="list-title">Account Settings</h2>
                <div class="account-section">
                    <form class="account-form">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" class="input-fullname" value="" />
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" value="example@email.com" />
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" value="+84 123 456 789" />
                        </div>
                        <button type="button" class="save-btn">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Hàm chuyển đổi tab
        function switchSection(sectionId) {
            // Ẩn tất cả các section
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });

            // Bỏ active class từ tất cả các menu item
            document.querySelectorAll('.menu__func > div').forEach(item => {
                item.classList.remove('active');
            });

            // Hiển thị section được chọn
            document.getElementById(sectionId).style.display = 'block';

            // Thêm active class cho menu item được chọn
            let activeClass = '';
            switch (sectionId) {
                case 'bookings':
                    activeClass = 'func1';
                    break;
                case 'transactions':
                    activeClass = 'func2';
                    break;
                case 'account':
                    activeClass = 'func3';
                    break;
            }
            document.querySelector('.' + activeClass).classList.add('active');
        }

        // Hàm xử lý thông báo
        function toggleNoti() {
            const notiTab = document.getElementById('notiTab');
            const userDropdown = document.getElementById('userDropdown');

            // Ẩn dropdown user nếu đang mở
            if (userDropdown.classList.contains('active')) {
                userDropdown.classList.remove('active');
            }

            // Toggle hiển thị thông báo
            if (notiTab.style.display === 'block') {
                notiTab.style.display = 'none';
            } else {
                notiTab.style.display = 'block';
            }
        }

        // Hàm xử lý dropdown user
        function toggleDropdown() {
            const dropdown = document.getElementById('userDropdown');
            const notiTab = document.getElementById('notiTab');

            // Ẩn thông báo nếu đang mở
            if (notiTab.style.display === 'block') {
                notiTab.style.display = 'none';
            }

            // Toggle hiển thị dropdown
            dropdown.classList.toggle('active');
        }

        // Đóng dropdown khi click ra ngoài
        window.onclick = function (event) {
            const userBox = document.querySelector('.user-box');
            const notiWrapper = document.querySelector('.noti-wrapper');
            const dropdown = document.getElementById('userDropdown');
            const notiTab = document.getElementById('notiTab');

            if (!userBox.contains(event.target) && !notiWrapper.contains(event.target)) {
                dropdown.classList.remove('active');
                notiTab.style.display = 'none';
            }
        }

        // Hàm xử lý chỉnh sửa booking
        function editBooking(id) {
            // Chuyển hướng đến trang chỉnh sửa booking
            window.location.href = `/booking/${id}/edit`;
        }

        // Hàm xử lý xóa booking
        function deleteBooking(id) {
            if (confirm('Bạn có chắc chắn muốn hủy đặt phòng này?')) {
                // Gọi API để xóa booking
                fetch(`/booking/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            // Xóa card booking khỏi giao diện
                            const bookingCard = document.querySelector(`[data-booking-id="${id}"]`);
                            if (bookingCard) {
                                bookingCard.remove();
                            }
                            alert('Hủy đặt phòng thành công!');
                        } else {
                            alert('Có lỗi xảy ra khi hủy đặt phòng!');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('Có lỗi xảy ra khi hủy đặt phòng!');
                    });
            }
        }

        // Hàm xử lý hiển thị chi tiết giao dịch
        function toggleTransactionDetails(card) {
            const details = card.querySelector('.transaction-details');
            if (details.style.display === 'block') {
                details.style.display = 'none';
            } else {
                details.style.display = 'block';
            }
        }

        // Hàm lấy thông tin user từ session
        function loadUserInfo() {
            fetch('/api/user/info')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Cập nhật thông tin user trong header
                    const userFullName = document.getElementById('userFullName');
                    if (userFullName) userFullName.textContent = data.full_name || data.username || 'User';

                    const userName = document.querySelector('.user-name');
                    const userRole = document.querySelector('.user-role');
                    if (userName) {
                        userName.textContent = data.full_name || data.username;
                    }
                    if (userRole) {
                        userRole.textContent = data.role || 'User';
                    }

                    // Cập nhật thông tin trong form account
                    if (document.querySelector('.account-form')) {
                        document.querySelector('.account-form .input-fullname').value = data.full_name || '';
                        document.querySelector('.account-form input[type="email"]').value = data.email || '';
                        document.querySelector('.account-form input[type="tel"]').value = data.phone || '';
                    }
                })
                .catch(error => {
                    console.error('Error loading user info:', error);
                    // Hiển thị lỗi nhẹ nhàng trên UI, không alert
                    const userFullName = document.getElementById('userFullName');
                    if (userFullName) userFullName.textContent = 'Error loading user info!';
                });
        }

        // Hàm lấy danh sách booking
        function loadBookings() {
            fetch('/api/user/bookings')
                .then(response => response.json())
                .then(data => {
                    const bookingList = document.querySelector('.booking-list');
                    bookingList.innerHTML = ''; // Xóa danh sách cũ

                    if (data.bookings && data.bookings.length > 0) {
                        data.bookings.forEach(booking => {
                            const bookingCard = createBookingCard(booking);
                            bookingList.appendChild(bookingCard);
                        });
                    } else {
                        bookingList.innerHTML = '<div class="no-bookings">Bạn chưa có đặt phòng nào</div>';
                    }
                })
                .catch(error => console.error('Error loading bookings:', error));
        }

        // Hàm tạo card booking
        function createBookingCard(booking) {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.bookingId = booking.id;

            const days = calculateDays(booking.check_in, booking.check_out);

            // Định nghĩa status badge class
            let statusClass = '';
            let statusText = '';

            switch (booking.status) {
                case 'confirmed':
                    statusClass = 'confirmed';
                    statusText = 'Confirmed';
                    break;
                case 'pending':
                    statusClass = 'pending';
                    statusText = 'Pending';
                    break;
                case 'failed':
                    statusClass = 'failed';
                    statusText = 'Failed';
                    break;
                case 'success':
                    statusClass = 'success';
                    statusText = 'Success';
                    break;
                default:
                    statusClass = '';
                    statusText = booking.status || 'Pending';
            }

            card.innerHTML = `
                <div class="card__img">
                    <div class="status-badge ${statusClass}">${statusText}</div>
                    <img src="${booking.image_url || '/assets/image/default-room.webp'}" alt="Room Image">
                </div>
                <div class="card__info">
                    <div class="date"><b>${booking.check_in} - ${booking.check_out}</b></div>
                    <div class="day">${days} Day(s)</div>
                    <div class="location">${booking.hotel_name || ''}</div>
                    <div class="room-type">${booking.room_type || ''}</div>
                    <div class="address">${booking.hotel_address || ''}</div>
                    <div class="total-price">Total: ${formatPrice(booking.total_price)}</div>
                </div>
            `;

            return card;
        }

        // Hàm format ngày tháng
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                day: 'numeric',
                month: 'short'
            });
        }

        // Hàm tính số ngày
        function calculateDays(checkIn, checkOut) {
            const start = new Date(checkIn);
            const end = new Date(checkOut);
            const diffTime = Math.abs(end - start);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        // Hàm format giá tiền
        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(price);
        }

        // Hàm lấy class CSS cho trạng thái booking
        function getStatusClass(status) {
            switch (status) {
                case 'confirmed': return 'status-confirmed';
                case 'pending': return 'status-pending';
                case 'cancelled': return 'status-cancelled';
                case 'completed': return 'status-completed';
                default: return '';
            }
        }

        // Hàm lấy text hiển thị cho trạng thái booking
        function getStatusText(status) {
            switch (status) {
                case 'confirmed': return 'Đã xác nhận';
                case 'pending': return 'Đang chờ xác nhận';
                case 'cancelled': return 'Đã hủy';
                case 'completed': return 'Đã hoàn thành';
                default: return status;
            }
        }

        // Hàm cập nhật thông tin tài khoản
        function updateAccountInfo() {
            const form = document.querySelector('.account-form');
            const formData = {
                full_name: form.querySelector('.input-fullname').value,
                email: form.querySelector('input[type="email"]').value,
                phone: form.querySelector('input[type="tel"]').value
            };

            fetch('/api/user/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Cập nhật thông tin thành công!', 'success');
                        loadUserInfo(); // Reload thông tin user
                    } else {
                        showNotification('Có lỗi xảy ra khi cập nhật thông tin!', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showNotification('Có lỗi xảy ra khi cập nhật thông tin!', 'error');
                });
        }

        // Hàm load thông báo
        function loadNotifications() {
            fetch('/api/user/notifications')
                .then(response => response.json())
                .then(data => {
                    const notiList = document.querySelector('.noti-list');
                    const notiCount = document.querySelector('.noti-count');

                    if (data.notifications && data.notifications.length > 0) {
                        notiList.innerHTML = data.notifications.map(noti => `
                            <div class="noti-item ${noti.read ? '' : 'unread'}">
                                <div class="noti-icon">
                                    <i class="${getNotiIcon(noti.type)}"></i>
                                </div>
                                <div class="noti-content">
                                    <p class="noti-text">${noti.message}</p>
                                    <span class="noti-time">${formatTimeAgo(noti.created_at)}</span>
                                </div>
                            </div>
                        `).join('');

                        const unreadCount = data.notifications.filter(n => !n.read).length;
                        notiCount.textContent = unreadCount;
                        document.querySelector('.dot').classList.toggle('has-noti', unreadCount > 0);
                    } else {
                        notiList.innerHTML = '<div class="no-notifications">Không có thông báo mới</div>';
                        notiCount.textContent = '0';
                        document.querySelector('.dot').classList.remove('has-noti');
                    }
                })
                .catch(error => console.error('Error loading notifications:', error));
        }

        // Hàm load giao dịch
        function loadTransactions() {
            fetch('/api/user/transactions')
                .then(response => response.json())
                .then(data => {
                    const transactionsList = document.querySelector('.transactions-list');

                    if (data.transactions && data.transactions.length > 0) {
                        transactionsList.innerHTML = data.transactions.map(transaction => `
                            <div class="transaction-card" onclick="toggleTransactionDetails(this)">
                                <div class="transaction-header">
                                    <div class="transaction-date">${formatDate(transaction.date)}</div>
                                    <div class="transaction-id">#${transaction.id}</div>
                                </div>
                                <div class="transaction-amount">${formatPrice(transaction.amount)}</div>
                                <div class="transaction-info">
                                    <div class="transaction-hotel">${transaction.hotel_name}</div>
                                    <div class="transaction-nights">${transaction.nights} nights</div>
                                </div>
                                <span class="transaction-status status-${transaction.status.toLowerCase()}">
                                    <i class="${getTransactionIcon(transaction.status)}"></i>
                                    ${getTransactionStatus(transaction.status)}
                                </span>
                            </div>
                        `).join('');
                    } else {
                        transactionsList.innerHTML = '<div class="no-transactions">Không có giao dịch nào</div>';
                    }
                })
                .catch(error => console.error('Error loading transactions:', error));
        }

        // Hàm lấy icon cho thông báo
        function getNotiIcon(type) {
            switch (type) {
                case 'booking': return 'fa-solid fa-calendar-check';
                case 'payment': return 'fa-solid fa-credit-card';
                case 'system': return 'fa-solid fa-circle-info';
                default: return 'fa-solid fa-bell';
            }
        }

        // Hàm lấy icon cho trạng thái giao dịch
        function getTransactionIcon(status) {
            switch (status.toLowerCase()) {
                case 'completed': return 'fas fa-check-circle';
                case 'pending': return 'fas fa-clock';
                case 'failed': return 'fas fa-times-circle';
                default: return 'fas fa-info-circle';
            }
        }

        // Hàm lấy text trạng thái giao dịch
        function getTransactionStatus(status) {
            switch (status.toLowerCase()) {
                case 'completed': return 'Hoàn thành';
                case 'pending': return 'Đang xử lý';
                case 'failed': return 'Thất bại';
                default: return status;
            }
        }

        // Hàm format thời gian
        function formatTimeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);

            if (diffInSeconds < 60) return 'Vừa xong';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} phút trước`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} giờ trước`;
            if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)} ngày trước`;
            return date.toLocaleDateString('vi-VN');
        }

        // Hàm hiển thị thông báo
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="${getNotificationIcon(type)}"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // Hàm lấy icon cho thông báo
        function getNotificationIcon(type) {
            switch (type) {
                case 'success': return 'fas fa-check-circle';
                case 'error': return 'fas fa-times-circle';
                case 'warning': return 'fas fa-exclamation-circle';
                default: return 'fas fa-info-circle';
            }
        }

        // Cập nhật khởi tạo trang
        document.addEventListener('DOMContentLoaded', function () {
            loadUserInfo();
            loadBookings();
            loadNotifications();
            loadTransactions();
            switchSection('bookings');

            // Thêm event listener cho nút Save Changes
            const saveButton = document.querySelector('.save-btn');
            if (saveButton) {
                saveButton.addEventListener('click', updateAccountInfo);
            }
        });
    </script>
</body>

</html>